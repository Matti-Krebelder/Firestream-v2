<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ panel_name }} | Modern Streaming Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e50914;
            --primary-dark: #b20710;
            --dark: #141414;
            --light: #f5f5f5;
            --gray: #808080;
            --gray-dark: #2a2a2a;
            --transition: all 0.3s ease;
            --glow: 0 0 10px rgba(229, 9, 20, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            overflow-x: hidden;
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            transition: var(--transition);
        }

        header.scrolled {
            background-color: var(--dark);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: var(--transition);
            text-shadow: var(--glow);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            margin-right: 10px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-size: 1rem;
            transition: var(--transition);
            position: relative;
            padding: 5px 0;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            background-color: rgba(0,0,0,0.5);
            border: 1px solid var(--gray);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            outline: none;
            width: 0;
            opacity: 0;
            transition: var(--transition);
        }

        .search-box.active input {
            width: 200px;
            opacity: 1;
            padding-left: 35px;
        }

        .search-box i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-box.active i {
            color: var(--primary);
        }

        .user-profile {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            transition: var(--transition);
            box-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
        }

        .user-profile:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.8);
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 100vh;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            padding: 0 50px;
            margin-bottom: 50px;
            background-attachment: fixed;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 600px;
        }

        .hero-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transform: translateX(-50px);
            opacity: 0;
            animation: slideIn 0.8s forwards 0.3s;
        }

        .hero-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.5;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transform: translateX(-50px);
            opacity: 0;
            animation: slideIn 0.8s forwards 0.5s;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
            transform: translateX(-50px);
            opacity: 0;
            animation: slideIn 0.8s forwards 0.7s;
        }

        .btn {
            padding: 10px 25px;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::after {
            left: 100%;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.8);
        }

        .btn-secondary {
            background-color: rgba(109, 109, 110, 0.7);
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            background-color: rgba(109, 109, 110, 0.4);
        }

        /* Content Sections */
        .content-section {
            padding: 0 50px;
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .content-row {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 20px 0;
            scroll-behavior: smooth;
        }

        .content-row::-webkit-scrollbar {
            height: 8px;
        }

        .content-row::-webkit-scrollbar-track {
            background: var(--gray-dark);
            border-radius: 10px;
        }

        .content-row::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .content-row::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .content-card {
            min-width: 220px;
            width: 220px;
            height: 330px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            transition: var(--transition);
            cursor: pointer;
            flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .content-card:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .content-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .content-card:hover img {
            opacity: 0.3;
            transform: scale(1.1);
        }

        .card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            opacity: 0;
            transition: var(--transition);
            transform: translateY(20px);
        }

        .content-card:hover .card-overlay {
            opacity: 1;
            transform: translateY(0);
        }

        .card-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .card-rating {
            color: gold;
        }

        .card-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .genre-tag {
            background-color: var(--primary);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            transition: var(--transition);
        }

        .genre-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--dark);
            width: 80%;
            max-width: 1000px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            transform: scale(0.9);
            transition: var(--transition);
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            border: 1px solid rgba(229, 9, 20, 0.3);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0,0,0,0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: var(--primary);
            transform: rotate(90deg);
        }

        .modal-poster {
            width: 100%;
            height: 400px;
            object-fit: cover;
            filter: brightness(0.8);
            transition: var(--transition);
        }

        .modal-content:hover .modal-poster {
            filter: brightness(1);
        }

        .modal-details {
            padding: 30px;
            position: relative;
        }

        .modal-title {
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        .modal-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--primary);
        }

        .modal-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--gray);
        }

        .modal-rating {
            color: gold;
        }

        .modal-description {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-genres {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
        }

        /* Footer */
        footer {
            background-color: var(--gray-dark);
            padding: 50px;
            text-align: center;
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--dark));
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .social-links a {
            color: var(--light);
            font-size: 1.5rem;
            transition: var(--transition);
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .social-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: var(--primary);
            z-index: -1;
            transform: scale(0);
            transition: var(--transition);
        }

        .social-links a:hover {
            color: var(--dark);
        }

        .social-links a:hover::before {
            transform: scale(1);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            padding: 5px 0;
        }

        .footer-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--light);
        }

        .footer-links a:hover::after {
            width: 100%;
        }

        .copyright {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Floating animation */
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Pulse animation */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Loading Animation */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--dark);
            z-index: 10000;
            animation: fadeOut 1s forwards 1s;
        }

        .loader-circle {
            width: 50px;
            height: 50px;
            border: 5px solid var(--gray-dark);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: relative;
        }

        .loader-circle::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 5px solid transparent;
            border-radius: 50%;
            border-top-color: var(--primary-dark);
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                pointer-events: none;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
            }
            
            .hero {
                padding: 0 20px;
                background-attachment: scroll;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-description {
                font-size: 1rem;
            }
            
            .content-section {
                padding: 0 20px;
            }
            
            .content-card {
                min-width: 150px;
                width: 150px;
                height: 225px;
            }
            
            .modal-content {
                width: 95%;
            }

            .modal-poster {
                height: 250px;
            }

            .nav-links {
                display: none;
            }
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0;
            pointer-events: none;
            z-index: 99;
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
        }

        .scroll-top.active {
            opacity: 1;
            pointer-events: all;
        }

        .scroll-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.8);
        }
        .trailer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 1001;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }
        
        .trailer-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .trailer-modal-content {
            width: 80%;
            max-width: 900px;
            position: relative;
        }
        
        .trailer-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .trailer-close:hover {
            color: var(--primary);
        }
        
        .trailer-iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 8px;
        }
        
        /* Series styles - Season selector */
        .season-selector {
            position: relative;
            margin-bottom: 20px;
        }
        
        .season-dropdown {
            background-color: var(--gray-dark);
            color: var(--light);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            border: 1px solid var(--gray);
        }
        
        .season-dropdown:hover {
            background-color: rgba(60, 60, 60, 0.8);
        }
        
        .season-dropdown i {
            margin-left: 10px;
            transition: var(--transition);
        }
        
        .season-dropdown.active i {
            transform: rotate(180deg);
        }
        
        .season-options {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: var(--gray-dark);
            border-radius: 5px;
            z-index: 10;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .season-selector.active .season-options {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .season-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .season-option:hover, .season-option.selected {
            background-color: var(--primary-dark);
        }
        
        /* Episode list */
        .episodes-container {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .episodes-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .episodes-container::-webkit-scrollbar-track {
            background: var(--gray-dark);
            border-radius: 10px;
        }
        
        .episodes-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .episode-item {
            display: flex;
            padding: 15px;
            background-color: rgba(40, 40, 40, 0.6);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }
        
        .episode-item:hover {
            background-color: rgba(60, 60, 60, 0.8);
            border-left-color: var(--primary);
            transform: translateX(5px);
        }
        
        .episode-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-right: 15px;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .episode-details {
            flex: 1;
        }
        
        .episode-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .episode-meta {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .series-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 5;
        }
        
        @media (max-width: 768px) {
            .trailer-iframe {
                height: 300px;
            }
            
            .trailer-modal-content {
                width: 95%;
            }
            
            .episodes-container {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader">
        <div class="loader-circle"></div>
    </div>

    <!-- Header -->
    <header>
        <a href="#" class="logo">
            <img src="{{ logo }}" width="40" height="40" alt="Logo">
            FireStream v2
        </a>
        <nav class="nav-links">
            <a href="#">Home</a>
            <a href="#">TV Shows</a>
            <a href="#">Movies</a>
            <a href="#">New & Popular</a>
            <a href="#">My List</a>
        </nav>
        <div class="user-menu">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Titles, people, genres">
            </div>
            <div class="user-profile">
                <i class="fas fa-user"></i>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-content">
            <h1 class="hero-title" id="hero-title">Loading...</h1>
            <p class="hero-description" id="hero-description">Loading description...</p>
            <div class="hero-buttons">
                <button class="btn btn-primary">
                    <i class="fas fa-play"></i> Play
                </button>
                <button class="btn btn-secondary">
                    <i class="fas fa-info-circle"></i> More Info
                </button>
            </div>
        </div>
    </section>

    <!-- Content Sections -->
    <main id="content-container">
        <!-- Sections will be dynamically added here -->
    </main>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">
                <i class="fas fa-times"></i>
            </button>
            <img src="" alt="" class="modal-poster" id="modal-poster">
            <div class="modal-details">
                <h2 class="modal-title" id="modal-title">Title</h2>
                <div class="modal-meta">
                    <span class="modal-rating" id="modal-rating">
                        <i class="fas fa-star"></i> 0.0
                    </span>
                    <span id="modal-year">2023</span>
                    <span id="modal-runtime">120 min</span>
                </div>
                <p class="modal-description" id="modal-description">Description</p>
                <div class="modal-genres" id="modal-genres">
                    <!-- Genres will be added here -->
                </div>
                
                <!-- Series specific content -->
                <div id="series-content" style="display: none;">
                    <div class="season-selector" id="season-selector">
                        <div class="season-dropdown" id="season-dropdown">
                            <span id="selected-season">Select Season</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="season-options" id="season-options">
                            <!-- Season options will be added here -->
                        </div>
                    </div>
                    
                    <div class="episodes-container" id="episodes-container">
                        <!-- Episodes will be added here -->
                    </div>
                </div>
                
                <div class="modal-buttons" id="modal-buttons">
                    <button class="btn btn-primary">
                        <i class="fas fa-play"></i> Play
                    </button>
                    <button class="btn btn-secondary">
                        <i class="fas fa-plus"></i> My List
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="trailer-modal" id="trailerModal">
        <div class="trailer-modal-content">
            <span class="trailer-close" id="trailerClose">
                <i class="fas fa-times"></i>
            </span>
            <iframe class="trailer-iframe" id="trailerIframe" allowfullscreen></iframe>
        </div>
    </div>

    <!-- Scroll to top button -->
    <div class="scroll-top" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Footer -->
    <footer>
        <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
        <div class="footer-links">
            <a href="#">Terms of Use</a>
            <a href="#">Privacy</a>
            <a href="#">Legal Notices</a>
            <a href="#">Cookie Preferences</a>
            <a href="#">Contact Us</a>
        </div>
        <p class="copyright">© 2025 FireStream v2. All Rights Reserved.</p>
    </footer>

    <script>
        // Global variables
        let genresMap = {};
        let featuredContent = null;
        let allMovies = []; // All movies
        let allSeries = []; // All series

        // DOM Elements
        const heroSection = document.getElementById('hero');
        const heroTitle = document.getElementById('hero-title');
        const heroDescription = document.getElementById('hero-description');
        const contentContainer = document.getElementById('content-container');
        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalPoster = document.getElementById('modal-poster');
        const modalRating = document.getElementById('modal-rating');
        const modalYear = document.getElementById('modal-year');
        const modalDescription = document.getElementById('modal-description');
        const modalGenres = document.getElementById('modal-genres');
        const searchBox = document.querySelector('.search-box');
        const searchIcon = searchBox.querySelector('i');
        const searchInput = searchBox.querySelector('input');
        const scrollTopBtn = document.getElementById('scrollTop');
        
        // Series elements
        const seriesContent = document.getElementById('series-content');
        const seasonSelector = document.getElementById('season-selector');
        const seasonDropdown = document.getElementById('season-dropdown');
        const selectedSeason = document.getElementById('selected-season');
        const seasonOptions = document.getElementById('season-options');
        const episodesContainer = document.getElementById('episodes-container');
        
        // Trailer elements
        const trailerModal = document.getElementById('trailerModal');
        const trailerClose = document.getElementById('trailerClose');
        const trailerIframe = document.getElementById('trailerIframe');

        // Current selected content
        let currentContent = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Load genres first
            fetchGenres().then(() => {
                // Then load content
                fetchContent();
            });

            // Set up event listeners
            setupEventListeners();
        });

        // Fetch genres from API
        async function fetchGenres() {
            try {
                const response = await fetch('{{ serverip }}:{{ port }}/API/GET/GENRES');
                const data = await response.json();
                
                // Create a map of genre IDs to names
                data.genres.forEach(genre => {
                    genresMap[genre.id] = genre.name;
                });
            } catch (error) {
                console.error('Error fetching genres:', error);
            }
        }

        // Fetch content from API
        async function fetchContent() {
            try {
                const response = await fetch('{{ serverip }}:{{ port }}/API/GET/MOVIELIST');
                const data = await response.json();
                
                // Store all movies and series
                allMovies = data.movies;
                allSeries = data.series;
                
                // Set featured content (random movie or series)
                const allContent = [...allMovies, ...allSeries];
                if (allContent.length > 0) {
                    const randomIndex = Math.floor(Math.random() * allContent.length);
                    featuredContent = allContent[randomIndex];
                    updateHeroSection(featuredContent);
                    
                    // Play-Button Event for Hero Section
                    const heroPlayBtn = document.querySelector('.hero-buttons .btn-primary');
                    heroPlayBtn.addEventListener('click', () => {
                        if (featuredContent.is_series) {
                            // Get first season and episode
                            const firstSeason = Object.keys(featuredContent.seasons)[0];
                            const firstEpisode = featuredContent.seasons[firstSeason][0];
                            window.location.href = `/watch-series/${encodeURIComponent(featuredContent.url)}/${encodeURIComponent(firstSeason)}/${encodeURIComponent(firstEpisode)}`;
                        } else {
                            window.location.href = `/watch/${encodeURIComponent(featuredContent.url)}`;
                        }
                    });
                    
                    // More Info button for Hero Section
                    const heroInfoBtn = document.querySelector('.hero-buttons .btn-secondary');
                    heroInfoBtn.addEventListener('click', () => {
                        showModal(featuredContent);
                    });
                }
                
                // Create sections
                createSection('Popular Movies', data.movies);
                createSection('TV Series', data.series);
                
                // Add more sections if needed
                if (data.movies.length > 5) {
                    createSection('Action & Adventure', 
                        data.movies.filter(movie => movie.genre_ids.includes(28) || movie.genre_ids.includes(12)));
                }
                
                if (data.series.length > 5) {
                    createSection('Documentaries', 
                        data.series.filter(series => series.genre_ids.includes(99)));
                }
                
                // Hide loader after content is loaded
                setTimeout(() => {
                    document.querySelector('.loader').style.display = 'none';
                }, 500);
            } catch (error) {
                console.error('Error fetching content:', error);
                document.querySelector('.loader').style.display = 'none';
                contentContainer.innerHTML = '<p style="text-align: center; padding: 50px;">Error loading content. Please try again later.</p>';
            }
        }

        // Update hero section with featured content
        function updateHeroSection(content) {
            heroTitle.textContent = content.title;
            heroDescription.textContent = content.overview;
            
            // Set background image
            if (content.backdrop_path) {
                heroSection.style.backgroundImage = `url(https://image.tmdb.org/t/p/original${content.backdrop_path})`;
            }
        }

        // Create a content section
        function createSection(title, items) {
            if (items.length === 0) return;
            
            const section = document.createElement('div');
            section.className = 'content-section';
            
            const sectionTitle = document.createElement('h2');
            sectionTitle.className = 'section-title';
            sectionTitle.innerHTML = `<i class="fas fa-${title.includes('TV') ? 'tv' : 'film'}"></i> ${title}`;
            
            const row = document.createElement('div');
            row.className = 'content-row';
            
            // Add items to the row
            items.forEach(item => {
                const card = createContentCard(item);
                row.appendChild(card);
            });
            
            section.appendChild(sectionTitle);
            section.appendChild(row);
            contentContainer.appendChild(section);
        }

        // Create a content card
        function createContentCard(item) {
            const card = document.createElement('div');
            card.className = 'content-card';
            
            // Set poster image
            const img = document.createElement('img');
            img.src = item.poster_path ? `https://image.tmdb.org/t/p/original${item.poster_path}` : 'https://via.placeholder.com/220x330?text=No+Image';
            img.alt = item.title;
            img.loading = "lazy";
            
            // Add series badge if it's a series
            if (item.is_series) {
                const badge = document.createElement('div');
                badge.className = 'series-badge';
                badge.innerHTML = `<i class="fas fa-tv"></i> Series`;
                card.appendChild(badge);
            }
            
            // Create overlay with details
            const overlay = document.createElement('div');
            overlay.className = 'card-overlay';
            
            const title = document.createElement('h3');
            title.className = 'card-title';
            title.textContent = item.title;
            
            const meta = document.createElement('div');
            meta.className = 'card-meta';
            
            const rating = document.createElement('span');
            rating.className = 'card-rating';
            rating.innerHTML = `<i class="fas fa-star"></i> ${item.vote_average.toFixed(1)}`;
            
            const year = document.createElement('span');
            year.textContent = item.release_date ? item.release_date.split('-')[0] : 'N/A';
            
            meta.appendChild(rating);
            meta.appendChild(year);
            
            // Add genres if available
            const genres = document.createElement('div');
            genres.className = 'card-genres';
            
            if (item.genre_ids && item.genre_ids.length > 0) {
                item.genre_ids.slice(0, 3).forEach(genreId => {
                    if (genresMap[genreId]) {
                        const genreTag = document.createElement('span');
                        genreTag.className = 'genre-tag';
                        genreTag.textContent = genresMap[genreId];
                        genres.appendChild(genreTag);
                    }
                });
            }
            
            overlay.appendChild(title);
            overlay.appendChild(meta);
            overlay.appendChild(genres);
            
            card.appendChild(img);
            card.appendChild(overlay);
            
            // Add click event to show modal
            card.addEventListener('click', () => showModal(item));
            
            return card;
        }

        // Show modal with content details
        function showModal(content) {
            // Store current content for reference
            currentContent = content;
            
            modalTitle.textContent = content.title;
            modalDescription.textContent = content.overview;
            modalRating.innerHTML = `<i class="fas fa-star"></i> ${content.vote_average.toFixed(1)}`;
            modalYear.textContent = content.release_date ? content.release_date.split('-')[0] : 'N/A';
            
            // Set poster image
            if (content.backdrop_path) {
                modalPoster.src = `https://image.tmdb.org/t/p/original${content.backdrop_path}`;
            } else if (content.poster_path) {
                modalPoster.src = `https://image.tmdb.org/t/p/original${content.poster_path}`;
            } else {
                modalPoster.src = 'https://via.placeholder.com/1000x400?text=No+Image';
            }
            
            // Add genres
            modalGenres.innerHTML = '';
            if (content.genre_ids && content.genre_ids.length > 0) {
                content.genre_ids.forEach(genreId => {
                    if (genresMap[genreId]) {
                        const genreTag = document.createElement('span');
                        genreTag.className = 'genre-tag';
                        genreTag.textContent = genresMap[genreId];
                        modalGenres.appendChild(genreTag);
                    }
                });
            }
            
            // Handle series content
            if (content.is_series) {
                seriesContent.style.display = 'block';
                populateSeasonSelector(content);
            } else {
                seriesContent.style.display = 'none';
            }
            
            // Update modal buttons
            updateModalButtons(content);
            
            // Show modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Update modal buttons based on content type
        function updateModalButtons(content) {
            const modalButtons = document.getElementById('modal-buttons');
            modalButtons.innerHTML = '';
            
            // Play Button
            const playBtn = document.createElement('button');
            playBtn.className = 'btn btn-primary';
            playBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            playBtn.addEventListener('click', () => {
                if (content.is_series) {
                    // Get first season and episode or currently selected
                    let season = selectedSeason.getAttribute('data-season-id');
                    if (!season) {
                        season = Object.keys(content.seasons)[0];
                    }
                    const episode = content.seasons[season][0];
                    window.location.href = `/watch-series/${encodeURIComponent(content.url)}/${encodeURIComponent(season)}/${encodeURIComponent(episode)}`;
                } else {
                    window.location.href = `/watch/${encodeURIComponent(content.url)}`;
                }
            });
            
            // Trailer Button (if available)
            if (content.trailer) {
                const trailerBtn = document.createElement('button');
                trailerBtn.className = 'btn btn-secondary';
                trailerBtn.innerHTML = '<i class="fas fa-film"></i> Trailer';
                trailerBtn.addEventListener('click', () => {
                    showTrailer(content.trailer);
                });
                modalButtons.appendChild(trailerBtn);
            }
            
            // My List Button
            const listBtn = document.createElement('button');
            listBtn.className = 'btn btn-secondary';
            listBtn.innerHTML = '<i class="fas fa-plus"></i> My List';
            
            modalButtons.appendChild(playBtn);
            modalButtons.appendChild(listBtn);
        }
        
        // Populate season selector for series
        function populateSeasonSelector(series) {
            if (!series.seasons || Object.keys(series.seasons).length === 0) {
                seriesContent.style.display = 'none';
                return;
            }
            
            // Reset selector
            seasonOptions.innerHTML = '';
            selectedSeason.textContent = 'Select Season';
            selectedSeason.removeAttribute('data-season-id');
            episodesContainer.innerHTML = '';
            
            // Add each season to options
            Object.keys(series.seasons).forEach((seasonId, index) => {
                const option = document.createElement('div');
                option.className = 'season-option';
                option.textContent = `Season ${extractSeasonNumber(seasonId)}`;
                option.setAttribute('data-season-id', seasonId);
                
                option.addEventListener('click', () => {
                    // Update selected season
                    selectedSeason.textContent = option.textContent;
                    selectedSeason.setAttribute('data-season-id', seasonId);
                    
                    // Mark as selected
                    document.querySelectorAll('.season-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    
                    // Close dropdown
                    seasonSelector.classList.remove('active');
                    
                    // Load episodes
                    loadEpisodes(series, seasonId);
                });
                
                seasonOptions.appendChild(option);
                
                // Auto-select first season
                if (index === 0) {
                    option.click();
                }
            });
        }
        
        // Extract season number from directory name
        function extractSeasonNumber(seasonDir) {
            const match = seasonDir.match(/\d+/);
            return match ? match[0] : seasonDir;
        }
        
        // Extract episode number from filename
        function extractEpisodeNumber(episodeFile) {
            const match = episodeFile.match(/\d+/);
            return match ? match[0] : episodeFile.replace('.mp4', '');
        }
        
        // Load episodes for selected season
        function loadEpisodes(series, seasonId) {
            const episodes = series.seasons[seasonId];
            episodesContainer.innerHTML = '';
            
            episodes.forEach((episode, index) => {
                const episodeItem = document.createElement('div');
                episodeItem.className = 'episode-item';
                
                const episodeNum = extractEpisodeNumber(episode);
                
                const numberEl = document.createElement('div');
                numberEl.className = 'episode-number';
                numberEl.textContent = episodeNum;
                
                const detailsEl = document.createElement('div');
                detailsEl.className = 'episode-details';
                
                const titleEl = document.createElement('div');
                titleEl.className = 'episode-title';
                titleEl.textContent = `Episode ${episodeNum}`;
                
                const metaEl = document.createElement('div');
                metaEl.className = 'episode-meta';
                
                detailsEl.appendChild(titleEl);
                detailsEl.appendChild(metaEl);
                
                episodeItem.appendChild(numberEl);
                episodeItem.appendChild(detailsEl);
                
                // Click to play episode
                episodeItem.addEventListener('click', () => {
                    window.location.href = `/watch-series/${encodeURIComponent(series.url)}/${encodeURIComponent(seasonId)}/${encodeURIComponent(episode)}`;
                });
                
                episodesContainer.appendChild(episodeItem);
            });
        }
        
        // Show trailer in modal
        function showTrailer(trailerUrl) {
            // Extract video ID from YouTube URL
            let videoId = '';
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = trailerUrl.match(regExp);
            
            if (match && match[2].length === 11) {
                videoId = match[2];
            }
            
            if (videoId) {
                const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&showinfo=0`;
                trailerIframe.src = embedUrl;
                trailerModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                alert('Trailer URL is not valid');
            }
        }
        
        // Close trailer modal
        function closeTrailerModal() {
            trailerModal.classList.remove('active');
            trailerIframe.src = '';
            document.body.style.overflow = 'auto';
        }

        // Set up event listeners
        function setupEventListeners() {
            // Modal close
            modalClose.addEventListener('click', () => {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            // Trailer modal close
            trailerClose.addEventListener('click', closeTrailerModal);
            
            // Close trailer modal when clicking outside
            trailerModal.addEventListener('click', (e) => {
                if (e.target === trailerModal) {
                    closeTrailerModal();
                }
            });
            
            // Season dropdown toggle
            seasonDropdown.addEventListener('click', () => {
                seasonSelector.classList.toggle('active');
                seasonDropdown.classList.toggle('active');
            });
            
            // Close season dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!seasonSelector.contains(e.target)) {
                    seasonSelector.classList.remove('active');
                    seasonDropdown.classList.remove('active');
                }
            });
            
            // Search box toggle
            searchIcon.addEventListener('click', () => {
                searchBox.classList.toggle('active');
                if (searchBox.classList.contains('active')) {
                    searchInput.focus();
                }
            });
            
            // Header scroll effect
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    document.querySelector('header').classList.add('scrolled');
                } else {
                    document.querySelector('header').classList.remove('scrolled');
                }

                // Show/hide scroll to top button
                if (window.scrollY > 300) {
                    scrollTopBtn.classList.add('active');
                } else {
                    scrollTopBtn.classList.remove('active');
                }
            });

            // Scroll to top
            scrollTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // Search functionality
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    performSearch(searchInput.value);
                }
            });
        }

        // Perform search
        function performSearch(query) {
            if (query.trim() === '') return;
            
            // Filter movies and series by title
            const normalizedQuery = query.toLowerCase();
            const filteredMovies = allMovies.filter(
                movie => movie.title.toLowerCase().includes(normalizedQuery)
            );
            const filteredSeries = allSeries.filter(
                series => series.title.toLowerCase().includes(normalizedQuery)
            );
            
            // Display results
            contentContainer.innerHTML = '';
            
            if (filteredMovies.length === 0 && filteredSeries.length === 0) {
                contentContainer.innerHTML = 
                    `<div class="content-section">
                        <h2 class="section-title">
                            <i class="fas fa-search"></i> No results found for "${query}"
                        </h2>
                        <p style="padding: 20px 0;">Try different keywords or browse our categories.</p>
                    </div>`;
            } else {
                if (filteredMovies.length > 0) {
                    createSection(`Search Results: Movies (${filteredMovies.length})`, filteredMovies);
                }
                
                if (filteredSeries.length > 0) {
                    createSection(`Search Results: Series (${filteredSeries.length})`, filteredSeries);
                }
            }
            
            // Clear the search box
            searchInput.value = '';
            searchBox.classList.remove('active');
        }
    </script>
</body>
</html>